{"version":3,"file":"slot-machine.js","names":["SlotMachine","container","reels","callback","options","self","REEL_SEGMENT_TOTAL","defaults","reelHeight","reelWidth","reelOffset","slotYAxis","animSpeed","sounds","reelsBegin","reelsEnd","rngFunc","Math","random","Object","assign","length","initGame","Error","createDisplayElm","createSlotElm","div","document","createElement","classList","add","i","elm","style","transform","appendChild","addEventListener","spinReels","forEach","reel","createReelElm","symbols","position","config","startPos","createStripElm","stripHeight","getStripHeight","stripWidth","getStripWidth","segmentDeg","transZ","trunc","tan","PI","marginTop","ul","height","width","li","append","toString","imgPosY","getImagePosY","rotateX","background","imageSrc","selectRandSymbol","totalWeight","symbolTotal","symbol","weight","randNum","getRandom","j","payLine","push","Array","prototype","apply","arguments","timer","window","setTimeout","isAnimating","clearTimeout","playSound","selected","element","remove","toggle","childNodes","index","backgroundPositionY","replace","getRandomInt","min","max","minNum","ceil","maxNum","floor","abs","url","audio","Audio","src","onerror","console","warn","play","dispatch","func","call","slotMachine","module","exports"],"sources":["../src/slot-machine.js"],"sourcesContent":["/**\r\n *  Slot Machine Generator\r\n *  Create an extremely biased, web-based slot machine game.\r\n *\r\n *  Copyright 2020-2023, Marc S. Brooks (https://mbrooks.info)\r\n *  Licensed under the MIT license:\r\n *  http://www.opensource.org/licenses/mit-license.php\r\n */\r\n\r\n'use strict';\r\n\r\n/**\r\n * @param {Element} container\r\n *   Containing HTML element.\r\n *\r\n * @param {Array<Object>} reels\r\n *   Reel configuration.\r\n *\r\n * @param {Function} callback\r\n *   Returns selected pay-line symbols.\r\n *\r\n * @param {Object} options\r\n *   Configuration overrides (optional).\r\n */\r\nfunction SlotMachine(container, reels, callback, options) {\r\n  const self = this;\r\n\r\n  const REEL_SEGMENT_TOTAL = 24;\r\n\r\n  const defaults = {\r\n    reelHeight: 1200,\r\n    reelWidth:  200,\r\n    reelOffset: 20,\r\n    slotYAxis: 0,\r\n    animSpeed:  1000,\r\n    sounds: {\r\n      reelsBegin: null,\r\n      reelsEnd: null\r\n    },\r\n    rngFunc: function() {\r\n\r\n      // The weakest link.\r\n      return Math.random();\r\n    },\r\n  };\r\n\r\n  (function() {\r\n    self.options = Object.assign(defaults, options);\r\n\r\n    if (reels.length > 0) {\r\n      initGame();\r\n    } else {\r\n      throw new Error('Failed to initialize (missing reels)');\r\n    }\r\n  })();\r\n\r\n  /**\r\n   * Initialize a new game instance.\r\n   */\r\n  function initGame() {\r\n    createDisplayElm();\r\n    createSlotElm();\r\n  }\r\n\r\n  /**\r\n   * Create display elements.\r\n   */\r\n  function createDisplayElm() {\r\n    const div = document.createElement('div');\r\n    div.classList.add('display');\r\n\r\n    for (let i = 0; i < reels.length; i++) {\r\n      const elm = document.createElement('div');\r\n      elm.style.transform = `rotateY(${self.options.slotYAxis}deg)`;\r\n      elm.classList.add('reel');\r\n\r\n      div.appendChild(elm);\r\n    }\r\n\r\n    div.addEventListener('click', () => spinReels());\r\n\r\n    container.appendChild(div);\r\n  }\r\n\r\n  /**\r\n   * Create slot elements.\r\n   */\r\n  function createSlotElm() {\r\n    const div = document.createElement('div');\r\n    div.classList.add('slots');\r\n\r\n    reels.forEach(reel => {\r\n      const elm = createReelElm(reel, reel.symbols[0].position);\r\n\r\n      div.appendChild(elm);\r\n    });\r\n\r\n    container.appendChild(div);\r\n  }\r\n\r\n  /**\r\n   * Create reel elements.\r\n   *\r\n   * @param {Object} config\r\n   *   Config options.\r\n   *\r\n   * @param {Number} startPos\r\n   *   Start position.\r\n   *\r\n   * @return {Element}\r\n   */\r\n  function createReelElm(config, startPos = 0) {\r\n    const div = document.createElement('div');\r\n    div.style.transform = `rotateY(${self.options.slotYAxis}deg)`;\r\n    div.classList.add('reel');\r\n\r\n    const elm = createStripElm(config, config.symbols[0].position);\r\n\r\n    config['element'] = elm;\r\n\r\n    div.appendChild(elm);\r\n\r\n    return div;\r\n  }\r\n\r\n  /**\r\n   * Create strip elements (faux-panoramic animation).\r\n   *\r\n   * @param {Object} config\r\n   *   Config options.\r\n   *\r\n   * @param {Number} startPos\r\n   *   Start position.\r\n   *\r\n   * @return {Element}\r\n   */\r\n  function createStripElm(config, startPos = 0) {\r\n    const stripHeight = getStripHeight();\r\n    const stripWidth  = getStripWidth();\r\n\r\n    const segmentDeg = 360 / REEL_SEGMENT_TOTAL;\r\n\r\n    const transZ = Math.trunc(\r\n      Math.tan(90 / Math.PI - segmentDeg) * (stripHeight * 0.5) * 4\r\n    );\r\n\r\n    const marginTop = transZ + stripHeight / 2;\r\n\r\n    const ul = document.createElement('ul');\r\n    ul.style.height    = stripHeight + 'px';\r\n    ul.style.marginTop = marginTop   + 'px';\r\n    ul.style.width     = stripWidth  + 'px';\r\n    ul.classList.add('strip');\r\n\r\n    for (let i = 0; i < REEL_SEGMENT_TOTAL; i++) {\r\n      const li = document.createElement('li');\r\n      li.append(i.toString());\r\n\r\n      const imgPosY = getImagePosY(i, startPos);\r\n      const rotateX = (REEL_SEGMENT_TOTAL * segmentDeg) - (i * segmentDeg);\r\n\r\n      // Position image per the strip angle/container radius.\r\n      li.style.background = `url(${config.imageSrc}) 0 ${imgPosY}px`;\r\n      li.style.height     = stripHeight + 'px';\r\n      li.style.width      = stripWidth  + 'px';\r\n      li.style.transform  = `rotateX(${rotateX}deg) translateZ(${transZ}px)`;\r\n\r\n      ul.appendChild(li);\r\n    }\r\n\r\n    return ul;\r\n  }\r\n\r\n  /**\r\n   * Select a random symbol by weight.\r\n   *\r\n   * @param {Array<Object>} symbols\r\n   *   List of symbols.\r\n   *\r\n   * @return {Object}\r\n   */\r\n  function selectRandSymbol(symbols) {\r\n    let totalWeight = 0;\r\n\r\n    const symbolTotal = symbols.length;\r\n\r\n    for (let i = 0; i < symbolTotal; i++) {\r\n      const symbol = symbols[i];\r\n      const weight = symbol.weight;\r\n\r\n      totalWeight += weight;\r\n    }\r\n\r\n    let randNum = getRandom() * totalWeight;\r\n\r\n    for (let j = 0; j < symbolTotal; j++) {\r\n      const symbol = symbols[j];\r\n      const weight = symbol.weight;\r\n\r\n      if (randNum < weight) {\r\n        return symbol;\r\n      }\r\n\r\n      randNum -= weight;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Spin the reels and try your luck.\r\n   */\r\n  function spinReels() {\r\n    const payLine = [];\r\n\r\n    if (callback) {\r\n\r\n      // Delay callback until animations have stopped.\r\n      payLine.push = function() {\r\n        Array.prototype.push.apply(this, arguments);\r\n\r\n        if (payLine.length === reels.length) {\r\n          const timer = window.setTimeout(() => {\r\n            self.isAnimating = false;\r\n\r\n            callback(payLine);\r\n\r\n            window.clearTimeout(timer);\r\n          }, self.options.animSpeed);\r\n        }\r\n      };\r\n    }\r\n\r\n    playSound(self.options.sounds.reelsBegin);\r\n\r\n    reels.forEach(reel => {\r\n      const selected = selectRandSymbol(reel.symbols);\r\n      const startPos = selected.position;\r\n\r\n      // Start the rotation animation.\r\n      const elm = reel.element;\r\n      elm.classList.remove('stop');\r\n      elm.classList.toggle('spin');\r\n\r\n      // Shift images to select position.\r\n      elm.childNodes.forEach((li, index) => {\r\n        li.style.backgroundPositionY = getImagePosY(index, startPos) + 'px';\r\n      });\r\n\r\n      // Randomly stop rotation animation.\r\n      const timer = window.setTimeout(() => {\r\n        elm.classList.replace('spin', 'stop');\r\n\r\n        playSound(self.options.sounds.reelsEnd);\r\n\r\n        payLine.push(selected);\r\n\r\n        window.clearTimeout(timer);\r\n      }, self.options.animSpeed * getRandomInt(1, 4));\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get random number between 0 (inclusive) and 1 (exclusive).\r\n   *\r\n   * @return {number}\r\n   */\r\n  function getRandom() {\r\n    return self.options.rngFunc();\r\n  }\r\n\r\n  /**\r\n   * Get random integer between two values.\r\n   *\r\n   * @param {Number} min\r\n   *   Minimum value (default: 0).\r\n   *\r\n   * @param {Number} max\r\n   *   Maximum value (default: 10).\r\n   *\r\n   * @return {Number}\r\n   */\r\n  function getRandomInt(min = 1, max = 10) {\r\n    const minNum = Math.ceil(min);\r\n    const maxNum = Math.floor(max);\r\n\r\n    return Math.floor(getRandom() * (Math.floor(maxNum) - minNum)) + minNum;\r\n  }\r\n\r\n  /**\r\n   * Calculate the strip background position.\r\n   *\r\n   * @param {Number} index\r\n   *   Strip symbol index.\r\n   *\r\n   * @param {Number} position\r\n   *   Strip target position.\r\n   *\r\n   * @return {Number}\r\n   */\r\n  function getImagePosY(index, position) {\r\n    return -Math.abs(\r\n      (getStripHeight() * index) + (position - self.options.reelOffset)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Calculate the strip height.\r\n   *\r\n   * @return {Number}\r\n   */\r\n  function getStripHeight() {\r\n    return self.options.reelHeight / REEL_SEGMENT_TOTAL;\r\n  }\r\n\r\n  /**\r\n   * Calculate the strip width.\r\n   *\r\n   * @return {Number}\r\n   */\r\n  function getStripWidth() {\r\n    return self.options.reelWidth;\r\n  }\r\n\r\n  /**\r\n   * Play the audio clip.\r\n   *\r\n   * @param {String} url\r\n   *  Audio file URL.\r\n   */\r\n  function playSound(url) {\r\n    if (url) {\r\n      const audio = new Audio();\r\n      audio.src = url;\r\n      audio.onerror = () => console.warn(`Failed to load audio: ${url}`);\r\n      audio.play();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dispatch game actions.\r\n   *\r\n   * @param {Function} func\r\n   *   Function to execute.\r\n   */\r\n  function dispatch(func) {\r\n    if (!self.isAnimating) {\r\n      self.isAnimating = true;\r\n\r\n      func.call(self);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Protected members.\r\n   */\r\n  this.play = function() {\r\n    dispatch(spinReels);\r\n  };\r\n}\r\n\r\n/**\r\n * Set global/exportable instance, where supported.\r\n */\r\nwindow.slotMachine = function(container, reels, callback, options) {\r\n  return new SlotMachine(container, reels, callback, options);\r\n};\r\n\r\nif (typeof module !== 'undefined' && module.exports) {\r\n  module.exports = SlotMachine;\r\n}\r\n"],"mappings":"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"}